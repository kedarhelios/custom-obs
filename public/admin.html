<!DOCTYPE html>
<html>
    <head>
        <title>Admin Viewer</title>
    </head>
    <body>
        <h2>Live Feed</h2>
        <video id="remoteVideo" autoplay playsinline controls></video>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            socket.emit("role", "viewer");

            const video = document.getElementById("remoteVideo");
            let pc = new RTCPeerConnection({
                iceServers: [
                    { urls: "stun:stun.l.google.com:19302" },
                    {
                        urls: "turn:turn.anyfirewall.com:443?transport=tcp",
                        username: "webrtc",
                        credential: "webrtc",
                    },
                ],
            });

            pc.ontrack = (event) => {
                video.srcObject = event.streams[0];
            };

            socket.on("offer", async (offer) => {
                await pc.setRemoteDescription(new RTCSessionDescription(offer));
                const answer = await pc.createAnswer();
                await pc.setLocalDescription(answer);
                socket.emit("answer", answer);
            });

            socket.on("ice-candidate", async (candidate) => {
                if (candidate) await pc.addIceCandidate(candidate);
            });

            pc.onicecandidate = ({ candidate }) => {
                if (candidate) socket.emit("ice-candidate", candidate);
            };
        </script>
    </body>
</html>
